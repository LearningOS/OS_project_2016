# 网络部分调研报告

## 主要目标
在上学期完成的MIPS ucore的基础上，加入网络扩展功能，能够实现简单的TCP协议，可以与远端机器有线连接并传输文件。   
具体的：   
* 完成以太网接口的驱动；   
* 完成在内核态实现的FTP协议，使得可以进行文件传输（12周以前）；   
* 尝试进行进一步的扩展：在内核态或用户态实现其它TCP协议，如HTTP/SMTP等（12周以后及暑期）；   

## 接口驱动
ThinPAD硬件部分含有一个DM9000以太网芯片，之前在计算机组成原理实验中，我们并没有实现这个芯片的功能以及所需的驱动，因此在本实验中需要实现。   
这个接口及其驱动的实现方法详见《GDB远程调试接口暨硬件调研设计报告》的以太网芯片部分。   

## 网络标准：TCP/IP协议栈
经过调研，我们决定按照TCP/IP的标准来实现本实验中的网络功能。
### 网络接口层
最底层，直接与硬件交互。   
在实现了以太网接口的驱动后，需要实现ARP协议，交换两端的MAC地址。   
### 网络层
需要实现IP协议，定义网络数据包的格式，将数据封装成数据包，并实现数据包的发送和接收。   
### 传输层
通过传输协议实现主机之间的通信会话。   
传输协议一般有TCP和UDP两种，我们只需要实现TCP。   
### 应用层
最高层，直接访问网络，实现网络功能。   
我们需要实现的网络应用有FTP（用于传输文件），以及HTTP/SMTP（扩展）。   

【注：这只是初步的设计，之后在具体实现时，所需实现的网络协议可能有一些变化】

## 如何在ucore上扩展网络功能
经过调研，我们认为在ucore上扩展网络功能，对原有操作系统的改进主要包括以下两个部分的工作：
### 文件系统
目前MIPS ucore的文件系统sfs不支持创建文件，且支持的文件大小不能超过4MB，然而在网络中传输文件显然是需要支持创建文件和大于4MB的文件的。   
### 内核线程之间的通信
在进行网络通信时，需要一些额外的线程或进程，由于我们目前只准备在内核态实现TCP协议，所以需要加入一些新的内核线程来完成通信，而这些内核线程的状态显然是需要在通信的两端之间交互的，这就需要对内核线程及其调度的模块进行扩展。
